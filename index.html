<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engram - Visual Browser for AI Agent Skills & Memories</title>
    <meta name="description" content="Browse, search, and analyze AI agent skills and memories across your GitHub repos. Track costs, visualize knowledge, and understand what your agents have learned.">
    <meta property="og:title" content="Engram - Visual Browser for AI Agent Skills & Memories">
    <meta property="og:description" content="Browse, search, and analyze AI agent skills and memories across your GitHub repos.">
    <meta property="og:type" content="website">
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #7c3aed;
            --accent: #06b6d4;
            --bg-dark: #09090b;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.06);
            --border: rgba(255, 255, 255, 0.08);
            --text: #fafafa;
            --text-muted: #a1a1aa;
            --code-bg: #18181b;
            --success: #22c55e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(9, 9, 11, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-links a:hover { color: var(--text); }

        .nav-cta {
            background: var(--primary);
            color: white !important;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .nav-cta:hover { background: var(--primary-dark); }

        /* Hero */
        .hero {
            padding: 10rem 0 6rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent 60%);
            pointer-events: none;
        }

        .hero-badge {
            display: inline-block;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 0.35rem 1rem;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .hero-badge span { color: var(--primary-light); }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero h1 .gradient {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto 3rem;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 0.875rem 2rem;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            padding: 0.875rem 2rem;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--text-muted);
        }

        /* Features */
        .features {
            padding: 6rem 0;
        }

        .features h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .features .subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 4rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.2s;
            position: relative;
        }

        .feature-status {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            margin-bottom: 0.5rem;
        }

        .status-live { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .status-beta { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .status-roadmap { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }

        .feature-card:hover {
            background: var(--bg-card-hover);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1.25rem;
        }

        .feature-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .feature-card p {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Architecture */
        .architecture {
            padding: 6rem 0;
            border-top: 1px solid var(--border);
        }

        .architecture h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .architecture .subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 4rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .tier-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .tier-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .tier-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .tier-card.tier-1::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .tier-card.tier-2::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
        .tier-card.tier-3::before { background: linear-gradient(90deg, #22c55e, #4ade80); }

        .tier-label {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            margin-bottom: 1rem;
        }

        .tier-1 .tier-label { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .tier-2 .tier-label { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
        .tier-3 .tier-label { background: rgba(34, 197, 94, 0.15); color: #4ade80; }

        .tier-card h3 {
            font-size: 1.3rem;
            margin-bottom: 0.75rem;
        }

        .tier-card p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .tier-card code {
            background: var(--code-bg);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent);
        }

        /* Code block */
        .code-section {
            padding: 6rem 0;
            border-top: 1px solid var(--border);
        }

        .code-section h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .code-section .subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            overflow-x: auto;
            max-width: 700px;
            margin: 0 auto;
        }

        .code-block pre {
            font-family: 'SF Mono', 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            color: var(--text-muted);
        }

        .code-block .keyword { color: #c084fc; }
        .code-block .string { color: #86efac; }
        .code-block .comment { color: #52525b; }
        .code-block .func { color: #60a5fa; }
        .code-block .number { color: #fbbf24; }

        /* Stats */
        .stats {
            padding: 4rem 0;
            border-top: 1px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            text-align: center;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* CTA */
        .cta {
            padding: 8rem 0;
            text-align: center;
            position: relative;
        }

        .cta::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.1), transparent 60%);
            pointer-events: none;
        }

        .cta h2 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
        }

        .cta p {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--border);
            padding: 3rem 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--text-muted);
            text-decoration: none;
        }

        footer a:hover { color: var(--text); }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        /* Live Demo - full-width immersive */
        .demo {
            padding: 4rem 0 6rem;
            border-top: 1px solid var(--border);
        }

        .demo > .container {
            max-width: 1440px;
        }

        .demo h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .demo .subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .demo-source {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 2.5rem;
        }

        .demo-source code {
            background: var(--code-bg);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            color: var(--accent);
            font-size: 0.8rem;
        }

        .demo-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 1.5rem;
            min-height: 600px;
        }

        .demo-sidebar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            overflow-y: auto;
            max-height: 600px;
        }

        .demo-sidebar h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .demo-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            overflow-y: auto;
            max-height: 600px;
        }

        .demo-content h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .demo-content .meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .demo-content .meta-tag {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            background: var(--code-bg);
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .demo-content .rendered-md {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .demo-content .rendered-md h1 { font-size: 1.5rem; color: var(--text); margin: 1.5rem 0 0.75rem; }
        .demo-content .rendered-md h2 { font-size: 1.25rem; color: var(--text); margin: 1.25rem 0 0.5rem; }
        .demo-content .rendered-md h3 { font-size: 1.1rem; color: var(--text); margin: 1rem 0 0.5rem; }
        .demo-content .rendered-md p { margin-bottom: 0.75rem; }
        .demo-content .rendered-md code {
            background: var(--code-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent);
        }
        .demo-content .rendered-md pre {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 0.75rem 0;
            font-size: 0.8rem;
            line-height: 1.6;
        }
        .demo-content .rendered-md pre code {
            background: none;
            padding: 0;
            color: var(--text-muted);
        }
        .demo-content .rendered-md ul, .demo-content .rendered-md ol {
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .demo-content .rendered-md li { margin-bottom: 0.25rem; }
        .demo-content .rendered-md strong { color: var(--text); }
        .demo-content .rendered-md hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 1.5rem 0;
        }
        .demo-content .rendered-md table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            font-size: 0.85rem;
        }
        .demo-content .rendered-md th, .demo-content .rendered-md td {
            border: 1px solid var(--border);
            padding: 0.4rem 0.75rem;
            text-align: left;
        }
        .demo-content .rendered-md th {
            background: var(--code-bg);
            color: var(--text);
        }
        .demo-content .rendered-md blockquote {
            border-left: 3px solid var(--primary);
            padding-left: 1rem;
            margin: 0.75rem 0;
            color: var(--text-muted);
        }

        .tree-org {
            margin-bottom: 0.75rem;
        }

        .tree-org-label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            transition: background 0.15s;
        }

        .tree-org-label:hover { background: var(--bg-card-hover); }

        .tree-org-label .arrow {
            font-size: 0.7rem;
            transition: transform 0.2s;
            color: var(--text-muted);
        }

        .tree-org-label .arrow.open { transform: rotate(90deg); }

        .tree-org-label .org-icon { font-size: 1rem; }

        .tree-files {
            margin-left: 1.25rem;
            display: none;
        }

        .tree-files.open { display: block; }

        .tree-file {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-muted);
            transition: all 0.15s;
        }

        .tree-file:hover { background: var(--bg-card-hover); color: var(--text); }
        .tree-file.active { background: rgba(139, 92, 246, 0.15); color: var(--primary-light); }

        .tree-file .file-icon { font-size: 0.9rem; }

        .tier-badge-sm {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.1rem 0.4rem;
            border-radius: 999px;
            margin-left: auto;
            flex-shrink: 0;
        }

        /* Demo tabs */
        .demo-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }
        .demo-tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }
        .demo-tab:hover { color: var(--text); }
        .demo-tab.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary);
        }
        .demo-tab-panel { display: none; }
        .demo-tab-panel.active { display: block; }

        /* 3D Timeline Graph - fullscreen overlay */
        #panel-timeline.active {
            display: block;
            position: fixed;
            inset: 0;
            z-index: 200;
            background: var(--bg-dark);
            padding: 0;
        }
        .tl-topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            background: rgba(9,9,11,0.95);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
            height: 44px;
            flex-shrink: 0;
        }
        .tl-topbar-title {
            font-size: 0.9rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .tl-topbar-right { display: flex; align-items: center; gap: 0.75rem; }
        .tl-close-btn {
            background: none; border: 1px solid var(--border); color: var(--text-muted);
            padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer;
            font-size: 0.78rem; transition: all 0.15s;
        }
        .tl-close-btn:hover { color: var(--text); border-color: var(--text-muted); }
        .timeline-3panel {
            display: grid;
            grid-template-columns: 200px 1fr 340px;
            height: calc(100vh - 44px);
            overflow: hidden;
            background: var(--bg-dark);
        }
        .tl-left {
            background: rgba(255,255,255,0.02);
            border-right: 1px solid var(--border);
            padding: 1rem;
            overflow-y: auto;
        }
        .tl-left h4 {
            font-size: 0.72rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.6rem;
        }
        .tl-org-item {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 0.15rem;
            transition: all 0.15s;
            font-size: 0.82rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .tl-org-item:hover { background: var(--bg-card-hover); }
        .tl-org-item.active { background: rgba(139,92,246,0.15); color: var(--primary-light); }
        .tl-org-dot {
            width: 8px; height: 8px; border-radius: 50%;
            display: inline-block; margin-right: 6px; flex-shrink: 0;
        }
        .tl-count {
            font-size: 0.68rem; color: var(--text-muted);
            background: rgba(255,255,255,0.05); padding: 0.1rem 0.4rem; border-radius: 999px;
        }
        .tl-session-list { margin: 0.2rem 0 0.4rem 1.25rem; }
        .tl-session-item {
            padding: 0.2rem 0.45rem; border-radius: 5px; cursor: pointer;
            font-size: 0.73rem; color: var(--text-muted); transition: all 0.15s;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .tl-session-item:hover { background: var(--bg-card-hover); color: var(--text); }
        .tl-session-item.active { color: var(--primary-light); background: rgba(139,92,246,0.1); }
        .tl-graph {
            position: relative; overflow: hidden; background: #050508;
        }
        .tl-graph canvas { display: block; }
        .tl-legend {
            position: absolute; bottom: 0.75rem; left: 0.75rem;
            display: flex; gap: 0.75rem; font-size: 0.7rem; color: var(--text-muted);
            background: rgba(9,9,11,0.85); padding: 0.35rem 0.75rem;
            border-radius: 6px; backdrop-filter: blur(4px); z-index: 10; pointer-events: none;
        }
        .tl-legend-item { display: flex; align-items: center; gap: 4px; }
        .tl-legend-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
        .tl-hint {
            position: absolute; top: 0.75rem; right: 0.75rem;
            font-size: 0.7rem; color: rgba(255,255,255,0.3); z-index: 10; pointer-events: none;
        }
        .tl-right {
            background: rgba(255,255,255,0.02);
            border-left: 1px solid var(--border);
            padding: 1.25rem; overflow-y: auto;
        }
        .tl-right h3 { font-size: 1rem; margin-bottom: 0.5rem; }
        .tl-metrics {
            display: grid; grid-template-columns: 1fr 1fr; gap: 0.4rem; margin-bottom: 1rem;
        }
        .tl-metric-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 8px; padding: 0.45rem 0.6rem;
        }
        .tl-metric-card .label { font-size: 0.63rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.03em; }
        .tl-metric-card .value { font-size: 0.88rem; font-weight: 600; }
        .tl-detail-content {
            font-size: 0.82rem; line-height: 1.6; color: var(--text-muted);
        }
        .tl-detail-content h1, .tl-detail-content h2 { font-size: 0.95rem; color: var(--text); margin: 0.75rem 0 0.3rem; }
        .tl-detail-content h3, .tl-detail-content h4 { font-size: 0.85rem; color: var(--text); margin: 0.5rem 0 0.2rem; }
        .tl-detail-content p { margin-bottom: 0.4rem; }
        .tl-detail-content code { background: var(--code-bg); padding: 0.1rem 0.25rem; border-radius: 3px; font-size: 0.78rem; }
        .tl-detail-content pre { background: var(--code-bg); padding: 0.75rem; border-radius: 6px; overflow-x: auto; margin: 0.5rem 0; font-size: 0.75rem; }
        .tl-detail-content ul, .tl-detail-content ol { padding-left: 1.25rem; margin-bottom: 0.5rem; }
        .tl-detail-content table { width: 100%; border-collapse: collapse; margin: 0.5rem 0; font-size: 0.75rem; }
        .tl-detail-content th, .tl-detail-content td { padding: 0.3rem 0.5rem; border: 1px solid var(--border); text-align: left; }
        .tl-detail-content th { background: var(--bg-card); font-weight: 600; }
        .tl-placeholder {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; text-align: center; color: var(--text-muted); font-size: 0.85rem;
        }
        .tl-placeholder .icon { font-size: 2.5rem; margin-bottom: 0.75rem; opacity: 0.5; }
        @media (max-width: 900px) {
            .timeline-3panel { grid-template-columns: 1fr; height: calc(100vh - 44px); grid-template-rows: auto 1fr auto; }
            .tl-left { border-right: none; border-bottom: 1px solid var(--border); max-height: 120px; }
            .tl-graph { min-height: 300px; }
            .tl-right { border-left: none; border-top: 1px solid var(--border); max-height: 250px; }
        }

        .tier-badge-sm.t2 { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
        .tier-badge-sm.t3 { background: rgba(34, 197, 94, 0.15); color: #4ade80; }

        .demo-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
            gap: 1rem;
        }

        .demo-loading .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .demo-empty {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .demo-error {
            text-align: center;
            padding: 2rem;
            color: #fb7185;
            font-size: 0.9rem;
        }

        .demo-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 400px;
            color: var(--text-muted);
            text-align: center;
            gap: 1rem;
        }

        .demo-placeholder .icon { font-size: 3rem; opacity: 0.3; }
        .demo-placeholder p { font-size: 0.95rem; max-width: 300px; }

        .gh-link {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.5rem;
            transition: color 0.15s;
        }
        .gh-link:hover { color: var(--primary-light); }

        .word-count {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        /* Search */
        .search-box {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .search-input {
            flex: 1;
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s;
        }
        .search-input:focus { border-color: var(--primary); }
        .search-input::placeholder { color: #52525b; }
        .search-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.25rem;
        }
        .filter-chip {
            padding: 0.3rem 0.8rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            transition: all 0.15s;
        }
        .filter-chip:hover { border-color: var(--primary); color: var(--text); }
        .filter-chip.active { background: rgba(139, 92, 246, 0.15); border-color: var(--primary); color: var(--primary-light); }
        .search-results { max-height: 500px; overflow-y: auto; }
        .search-result {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .search-result:hover { border-color: rgba(139, 92, 246, 0.4); background: var(--bg-card-hover); }
        .search-result-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; }
        .search-result-meta { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .search-result-snippet { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; }
        .search-result-snippet mark { background: rgba(139, 92, 246, 0.3); color: var(--text); border-radius: 2px; padding: 0 2px; }
        .search-count { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; }
        .search-empty { text-align: center; padding: 3rem; color: var(--text-muted); }

        /* Analytics */
        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .analytics-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }
        .analytics-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .analytics-card .label { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem; }
        .chart-section { margin-bottom: 2rem; }
        .chart-title { font-size: 1rem; font-weight: 600; margin-bottom: 1rem; }
        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            height: 180px;
            padding: 0 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.4rem; }
        .bar {
            width: 100%;
            max-width: 60px;
            border-radius: 6px 6px 0 0;
            background: linear-gradient(to top, var(--primary), var(--primary-light));
            transition: height 0.5s ease-out;
            position: relative;
            min-height: 4px;
        }
        .bar .bar-value {
            position: absolute;
            top: -22px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-light);
            white-space: nowrap;
        }
        .bar-label { font-size: 0.7rem; color: var(--text-muted); text-align: center; margin-top: 0.4rem; }
        .model-bars { display: flex; flex-direction: column; gap: 0.75rem; }
        .model-row { display: flex; align-items: center; gap: 0.75rem; }
        .model-name { width: 140px; font-size: 0.85rem; color: var(--text); flex-shrink: 0; }
        .model-track {
            flex: 1;
            height: 24px;
            background: var(--code-bg);
            border-radius: 6px;
            overflow: hidden;
        }
        .model-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.6s ease-out;
            display: flex;
            align-items: center;
            padding-left: 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }
        .model-cost { width: 70px; font-size: 0.8rem; color: var(--text-muted); text-align: right; flex-shrink: 0; }
        .session-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 1rem; }
        .session-table th { text-align: left; padding: 0.6rem 0.75rem; color: var(--text-muted); border-bottom: 1px solid var(--border); font-weight: 500; }
        .session-table td { padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--border); color: var(--text); }
        .session-table tr:hover td { background: var(--bg-card-hover); }

        /* Sync */
        .sync-visual { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .sync-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .sync-panel h4 { font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; }
        .sync-org-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: var(--code-bg);
            font-size: 0.9rem;
        }
        .sync-org-item .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); flex-shrink: 0; }
        .sync-org-item .count { margin-left: auto; font-size: 0.75rem; color: var(--text-muted); }
        .sync-file-list { max-height: 300px; overflow-y: auto; }
        .sync-file-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .sync-file-item .icon { flex-shrink: 0; }
        .sync-file-item .hash { margin-left: auto; font-family: monospace; font-size: 0.7rem; color: #52525b; }
        .sync-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 0.85rem;
        }
        .sync-stat-row .label { color: var(--text-muted); }
        .sync-stat-row .value { color: var(--text); font-weight: 600; }
        .sync-progress {
            height: 4px;
            background: var(--code-bg);
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }
        .sync-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 2px;
            width: 100%;
            animation: syncPulse 2s ease-in-out infinite;
        }
        @keyframes syncPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Share */
        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.85rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            transition: all 0.15s;
            margin-left: 0.5rem;
        }
        .share-btn:hover { border-color: var(--primary); color: var(--primary-light); background: rgba(139, 92, 246, 0.08); }
        .share-toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .share-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* Explore Showcase Repos */
        .explore-bar {
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }
        .explore-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        .explore-chips-label {
            font-size: 0.75rem;
            color: #52525b;
        }
        .explore-chip {
            padding: 0.3rem 0.8rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            transition: all 0.15s;
        }
        .explore-chip:hover { border-color: var(--primary); color: var(--text); }
        .explore-chip.active {
            background: rgba(139, 92, 246, 0.15);
            border-color: var(--primary);
            color: var(--primary-light);
        }
        .explore-status {
            text-align: center;
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            min-height: 1.2em;
        }
        .explore-status.error { color: #fb7185; }

        /* Responsive */
        @media (max-width: 768px) {
            .demo-container { grid-template-columns: 1fr; }
            .demo-sidebar { max-height: 300px; }
            .analytics-summary { grid-template-columns: repeat(2, 1fr); }
            .sync-visual { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .hero p { font-size: 1.05rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .nav-links { display: none; }
            .cta h2 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="#" class="logo">Engram</a>
            <ul class="nav-links">
                <li><a href="#demo">Live Demo</a></li>
                <li><a href="#features">Features</a></li>
                <li><a href="#cli">CLI</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#sdk">SDK</a></li>
                <li><a href="https://github.com/engram-hq" target="_blank">GitHub</a></li>
                <li><a href="https://github.com/engram-hq/engram-web" class="nav-cta">Get Started</a></li>
            </ul>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <div class="hero-badge"><span>v2.1.0</span> &middot; Now with Local AI &middot; Zero API Cost</div>
            <h1>See what your <span class="gradient">AI agents</span> have learned</h1>
            <p>Visual browser for AI agent skills and memories. Now with a built-in local AI model - analyze any codebase, generate skills and memories, fully air-gapped. No API keys. No tokens. No cost.</p>
            <div class="hero-buttons">
                <a href="#demo" class="btn-primary">Try Live Demo</a>
                <a href="#cli" class="btn-secondary">Install CLI</a>
                <a href="https://github.com/engram-hq/engram-cli" class="btn-secondary">View on GitHub</a>
            </div>
        </div>
    </section>

    <section class="stats">
        <div class="container">
            <div class="stats-grid">
                <div>
                    <div class="stat-value">$0</div>
                    <div class="stat-label">AI API Cost</div>
                </div>
                <div>
                    <div class="stat-value">7B</div>
                    <div class="stat-label">Embedded Model</div>
                </div>
                <div>
                    <div class="stat-value">257</div>
                    <div class="stat-label">Tests Passing</div>
                </div>
                <div>
                    <div class="stat-value">~40s</div>
                    <div class="stat-label">Per Repo Analysis</div>
                </div>
            </div>
        </div>
    </section>

    <section class="demo" id="demo">
        <div class="container">
            <h2>Live Demo</h2>
            <p class="subtitle">Real skills and memories from public repos. Internal repos analyzed by the embedded AI model. All generated locally at $0 cost.</p>
            <p class="demo-source">Browsing repos from <code id="demo-org-label">engram-hq</code>, <code>sreniatnoc</code>, <code>ARTIFACTIQ</code>, and famous open-source projects</p>

            <div class="explore-bar">
                <div class="explore-chips" id="explore-chips">
                    <span class="explore-chips-label">AI-analyzed repos (click to load):</span>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('sreniatnoc/rusd')">sreniatnoc/rusd</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('engram-hq/engram-web')">engram-hq/engram-web</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('engram-hq/engram-sdk')">engram-hq/engram-sdk</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('fastapi/fastapi')">fastapi/fastapi</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('pallets/flask')">pallets/flask</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('astral-sh/ruff')">astral-sh/ruff</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('facebook/react')">facebook/react</button>
                    <button class="explore-chip showcase-chip" onclick="loadShowcase('denoland/deno')">denoland/deno</button>
                </div>
                <div class="explore-status" id="explore-status"></div>
            </div>

            <div class="demo-tabs">
                <button class="demo-tab active" data-tab="skills" onclick="switchDemoTab('skills')">&#9889; Skills</button>
                <button class="demo-tab" data-tab="timeline" onclick="switchDemoTab('timeline')">&#128218; Timeline</button>
                <button class="demo-tab" data-tab="search" onclick="switchDemoTab('search')">&#128270; Search</button>
                <button class="demo-tab" data-tab="analytics" onclick="switchDemoTab('analytics')">&#128176; Analytics</button>
                <button class="demo-tab" data-tab="sync" onclick="switchDemoTab('sync')">&#128260; Sync</button>
            </div>

            <div class="demo-tab-panel active" id="panel-skills">
                <div class="demo-container">
                    <div class="demo-sidebar" id="demo-tree">
                        <h3>Skill Tree</h3>
                        <div class="demo-loading" id="tree-loading">
                            <div class="spinner"></div>
                            <span>Scanning GitHub repos...</span>
                        </div>
                        <div id="tree-content"></div>
                    </div>
                    <div class="demo-content" id="demo-viewer">
                        <div class="demo-placeholder">
                            <div class="icon">&#128065;</div>
                            <p>Select a skill from the tree to view its content, fetched live from GitHub.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="demo-tab-panel" id="panel-timeline">
                <div class="tl-topbar">
                    <span class="tl-topbar-title">Engram Knowledge Graph</span>
                    <div class="tl-topbar-right">
                        <span style="font-size:0.7rem;color:var(--text-muted);">Drag to rotate &middot; Scroll to zoom &middot; Click nodes for details</span>
                        <button class="tl-close-btn" onclick="closeTimeline()">Esc &times;</button>
                    </div>
                </div>
                <div class="timeline-3panel">
                    <div class="tl-left" id="tl-left-panel">
                        <h4>Organizations</h4>
                        <div id="tl-org-tree"></div>
                        <div style="margin-top:1rem;padding-top:0.75rem;border-top:1px solid var(--border);">
                            <h4 style="margin-top:0;">Guide</h4>
                            <div style="font-size:0.72rem;color:var(--text-muted);line-height:1.5;">
                                <div>&#9679; Sphere = Memory session</div>
                                <div>&#9670; Diamond = Skill</div>
                                <div>Size = cost (log scale)</div>
                                <div>&#8594; Particles = data flow</div>
                                <div style="margin-top:0.35rem;">Click node for details</div>
                            </div>
                        </div>
                    </div>
                    <div class="tl-graph" id="tl-graph-container">
                        <div class="demo-loading" id="timeline-loading">
                            <div class="spinner"></div>
                            <span>Building knowledge graph...</span>
                        </div>
                        <div class="tl-hint"></div>
                    </div>
                    <div class="tl-right" id="tl-detail-panel">
                        <div class="tl-placeholder">
                            <div class="icon">&#127760;</div>
                            <p>Hover over nodes to see metrics.<br>Click a session to view full details.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="demo-tab-panel" id="panel-search">
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" placeholder="Search skills and memories... (e.g. 'Raft', 'TLS', 'Kubernetes')" oninput="runSearch()">
                </div>
                <div class="search-filters" id="search-filters">
                    <button class="filter-chip active" data-filter="all" onclick="setSearchFilter('all')">All</button>
                    <button class="filter-chip" data-filter="skill" onclick="setSearchFilter('skill')">&#9889; Skills</button>
                    <button class="filter-chip" data-filter="memory" onclick="setSearchFilter('memory')">&#128218; Memories</button>
                </div>
                <div class="search-count" id="search-count"></div>
                <div class="search-results" id="search-results">
                    <div class="search-empty">Type a query to search across all skills and memories with full-text search.</div>
                </div>
            </div>

            <div class="demo-tab-panel" id="panel-analytics">
                <div id="analytics-content">
                    <div class="demo-loading" id="analytics-loading">
                        <div class="spinner"></div>
                        <span>Computing cost analytics...</span>
                    </div>
                </div>
            </div>

            <div class="demo-tab-panel" id="panel-sync">
                <div id="sync-content">
                    <div class="demo-loading" id="sync-loading">
                        <div class="spinner"></div>
                        <span>Discovering GitHub repos...</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="features" id="features">
        <div class="container">
            <h2>Everything your agents know, in one place</h2>
            <p class="subtitle">Engram indexes skills and memories from your GitHub repos and gives you a visual dashboard to browse, search, and analyze them.</p>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(139, 92, 246, 0.15); color: #a78bfa;">&#9889;</div>
                    <span class="feature-status status-live">Live Demo</span>
                    <h3>Skill Browser</h3>
                    <p>Navigate your 3-tier skill hierarchy (User, Org, Repo) with tree view and list view. See frontmatter metadata, rendered markdown, and word counts.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(6, 182, 212, 0.15); color: #22d3ee;">&#129504;</div>
                    <span class="feature-status status-live">Live Demo</span>
                    <h3>3D Knowledge Graph</h3>
                    <p>Interactive 3D force-directed graph of sessions and skills. Nodes sized by cost, linked chronologically. Hover for metrics, click for full details.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(34, 197, 94, 0.15); color: #4ade80;">&#128176;</div>
                    <span class="feature-status status-live">Live Demo</span>
                    <h3>AI Cost Analytics</h3>
                    <p>Track agent activity and costs. Session counts, model usage, and org distribution from real data. Per-session cost tracking via SDK or memory frontmatter. Try the Analytics tab above.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(251, 191, 36, 0.15); color: #fbbf24;">&#128270;</div>
                    <span class="feature-status status-live">Live Demo</span>
                    <h3>Full-Text Search</h3>
                    <p>Search across all skills and memories with full-text matching. Faceted results by type, org, and tier with highlighted snippets. Try the Search tab above.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(244, 63, 94, 0.15); color: #fb7185;">&#128260;</div>
                    <span class="feature-status status-live">Live Demo</span>
                    <h3>GitHub Sync</h3>
                    <p>Auto-discover orgs, scan repos for .skills/ and .memory/ directories. Incremental sync with content hashing. See the Sync tab above for a live view.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="background: rgba(99, 102, 241, 0.15); color: #818cf8;">&#128241;</div>
                    <span class="feature-status status-roadmap">Roadmap</span>
                    <h3>iOS App</h3>
                    <p>Native SwiftUI app with Swift Charts for analytics. 59 tests passing, App Store metadata prepared. Pending Apple Developer enrollment and backend deployment.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="architecture" id="architecture">
        <div class="container">
            <h2>3-Tier Skill Architecture</h2>
            <p class="subtitle">Engram understands the hierarchical structure of AI agent knowledge - from personal skills to org-wide patterns to repo-specific techniques.</p>
            <div class="tier-list">
                <div class="tier-card tier-1">
                    <div class="tier-label">Tier 1 - User</div>
                    <h3>Cross-Org Skills</h3>
                    <p>Your personal routing rules, preferences, and cross-org knowledge. Stored in <code>orgs/skills/</code> at the top level.</p>
                </div>
                <div class="tier-card tier-2">
                    <div class="tier-label">Tier 2 - Organization</div>
                    <h3>Org Knowledge</h3>
                    <p>Shared conventions, coding standards, and operational knowledge for an entire GitHub org. Lives in <code>&lt;org&gt;/.skills/</code>.</p>
                </div>
                <div class="tier-card tier-3">
                    <div class="tier-label">Tier 3 - Repository</div>
                    <h3>Repo-Specific Skills</h3>
                    <p>Task-specific techniques like ML training configs, deployment scripts, and validation flows. Found in <code>&lt;repo&gt;/.skills/</code>.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="code-section" id="cli">
        <div class="container">
            <h2 style="display:flex;align-items:center;justify-content:center;gap:0.75rem;">Engram CLI <span style="background:linear-gradient(135deg,var(--primary),var(--accent));color:white;font-size:0.7rem;padding:0.25rem 0.7rem;border-radius:999px;font-weight:600;">v2.1.0 NEW</span></h2>
            <p class="subtitle">Analyze any codebase with a local AI model. No API keys. No tokens. No cloud. One command.</p>

            <div class="code-block">
<pre><span class="comment"># Install (one-time setup)</span>
<span class="func">brew</span> install ollama              <span class="comment"># macOS</span>
<span class="func">pip</span> install engram-cli            <span class="comment"># or: pip3 install engram-cli</span>

<span class="comment"># Analyze any local repo</span>
<span class="func">engram</span> analyze .

<span class="comment"># Analyze a GitHub repo by URL</span>
<span class="func">engram</span> analyze https://github.com/fastapi/fastapi

<span class="comment"># Or shorthand</span>
<span class="func">engram</span> analyze pallets/flask --org pallets</pre>
            </div>

            <p style="text-align:center;color:var(--text-muted);font-size:0.85rem;margin-top:1.5rem;">
                First run downloads Qwen2.5-Coder 7B (~4.5GB, one-time). Runs on 8GB RAM.<br>
                Upgrade models anytime: <code style="background:var(--code-bg);padding:2px 6px;border-radius:4px;">engram analyze . --model qwen2.5-coder:14b</code>
            </p>

            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;margin-top:2.5rem;">
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.25rem;">
                    <div style="font-size:1.5rem;margin-bottom:0.5rem;">&#127968;</div>
                    <h4 style="margin-bottom:0.5rem;">Fully Local</h4>
                    <p style="font-size:0.85rem;color:var(--text-muted);">Your code never leaves your machine. No API calls, no telemetry, no cloud dependency.</p>
                </div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.25rem;">
                    <div style="font-size:1.5rem;margin-bottom:0.5rem;">&#128176;</div>
                    <h4 style="margin-bottom:0.5rem;">Zero Cost</h4>
                    <p style="font-size:0.85rem;color:var(--text-muted);">No API tokens burned. Analyze unlimited repos. Perfect for researchers and students.</p>
                </div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.25rem;">
                    <div style="font-size:1.5rem;margin-bottom:0.5rem;">&#129504;</div>
                    <h4 style="margin-bottom:0.5rem;">Real AI Insights</h4>
                    <p style="font-size:0.85rem;color:var(--text-muted);">Qwen2.5-Coder 7B understands code deeply. Not just file counting - real architectural analysis.</p>
                </div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.25rem;">
                    <div style="font-size:1.5rem;margin-bottom:0.5rem;">&#128268;</div>
                    <h4 style="margin-bottom:0.5rem;">Pluggable</h4>
                    <p style="font-size:0.85rem;color:var(--text-muted);">Enterprise users can swap in Claude or GPT APIs for higher quality. Local model is the default.</p>
                </div>
            </div>

            <div style="margin-top:2.5rem;">
                <h3 style="text-align:center;margin-bottom:1.5rem;">What You Get</h3>
                <div class="code-block">
<pre><span class="func">$</span> engram analyze fastapi/fastapi

<span class="comment"></span>
<span class="comment"> Engram v2.1.0 - Local AI Code Analyzer </span>
<span class="comment"></span>

<span class="keyword">Phase 1:</span> Heuristic Analysis
  Languages: Python (89%), Markdown (6%), Shell (3%)
  Frameworks: FastAPI, Starlette, Pydantic, Uvicorn, pytest
  Testing: pytest (142 test files)
  CI/CD: GitHub Actions (5 workflows)
  Patterns: REST API, Middleware, Documentation site

<span class="keyword">Phase 2:</span> Local Model Inference (qwen2.5-coder:7b)
  [1/5] Generating architecture skill...
  [2/5] Generating patterns skill...
  [3/5] Generating testing skill...
  [4/5] Generating project overview...
  [5/5] Generating activity analysis...

<span class="string"> Results for fastapi/fastapi </span>
<span class="string"> Generated 3 skills + 2 memories               </span>
<span class="string"> Model: qwen2.5-coder:7b | Time: 42s | Cost: $0</span>
<span class="string"></span></pre>
                </div>
            </div>
        </div>
    </section>

    <section class="code-section" id="sdk">
        <div class="container">
            <h2>Agent Metrics SDK</h2>
            <p class="subtitle">Lightweight TypeScript SDK to track what your agents do. Automatic batching, retry, and cost calculation.</p>
            <div class="code-block">
<pre><span class="keyword">import</span> { Engram } <span class="keyword">from</span> <span class="string">'@engram-hq/sdk'</span>

<span class="keyword">const</span> engram = <span class="keyword">new</span> <span class="func">Engram</span>({ apiKey: <span class="string">'eng_...'</span> })

<span class="comment">// Track agent operations (batched automatically)</span>
engram.<span class="func">track</span>({
  operation: <span class="string">'create'</span>,
  targetType: <span class="string">'skill'</span>,
  agentType: <span class="string">'claude-code'</span>,
  modelId: <span class="string">'claude-opus-4-6'</span>,
  inputTokens: <span class="number">45230</span>,
  outputTokens: <span class="number">12847</span>,
  cacheReadTokens: <span class="number">128000</span>,
  durationMs: <span class="number">85430</span>,
})

<span class="comment">// Flush on exit</span>
<span class="keyword">await</span> engram.<span class="func">shutdown</span>()</pre>
            </div>
        </div>
    </section>

    <section class="code-section" id="try-locally">
        <div class="container">
            <h2>Get Started</h2>
            <p class="subtitle">Two ways to run Engram - pick what fits your workflow.</p>

            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;">
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
                    <h3 style="color:var(--accent);margin-bottom:1rem;">Option A: CLI (Recommended)</h3>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:1rem;">Analyze any repo from your terminal. No server needed.</p>
                    <div class="code-block" style="margin:0;">
<pre><span class="func">pip</span> install engram-cli
<span class="func">engram</span> analyze .</pre>
                    </div>
                </div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
                    <h3 style="color:var(--primary-light);margin-bottom:1rem;">Option B: Web Dashboard</h3>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:1rem;">Full web UI with search, timeline, analytics. Docker one-liner.</p>
                    <div class="code-block" style="margin:0;">
<pre><span class="func">git</span> clone https://github.com/engram-hq/engram-web.git
<span class="func">docker</span> compose -f docker-compose.local.yml up --build</pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>Analyze any codebase. Zero cost. Fully local.</h2>
            <p>Engram is open source. The CLI runs entirely on your machine with a built-in AI model. No API keys, no cloud, no cost. Perfect for researchers, educators, and teams who care about privacy.</p>
            <div class="hero-buttons">
                <a href="#cli" class="btn-primary">Install CLI</a>
                <a href="#try-locally" class="btn-secondary">Other Options</a>
                <a href="https://github.com/engram-hq/engram-cli" class="btn-secondary">GitHub</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="https://github.com/engram-hq">GitHub</a>
                <a href="https://github.com/engram-hq/engram-cli">CLI Tool</a>
                <a href="https://github.com/engram-hq/engram-web">Web App</a>
                <a href="https://github.com/engram-hq/engram-sdk">SDK</a>
                <a href="https://github.com/engram-hq/roadmap">Roadmap</a>
                <a href="privacy-policy.html">Privacy Policy</a>
            </div>
            <p>&copy; 2026 Engram. Built by <a href="https://ishaileshpant.github.io">Shailesh Pant</a>.</p>
        </div>
    </footer>
    <script src="demo-data.js"></script>
    <script>window.SHOWCASE_DATA = null;</script>
    <script>
    // Load showcase data (pre-analyzed famous repos)
    fetch('showcase-data.json').then(r => r.ok ? r.json() : null).then(d => { window.SHOWCASE_DATA = d; }).catch(() => {});
    </script>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
    <script>
    // ==========================================
    // LIVE DEMO - Instant load via script tag
    // ==========================================
    // Data loaded via demo-data.js (sync script tag, no fetch/CORS issues)
    // Fallback: fetch demo-data.json for HTTP deployments
    // Generated by CI workflow: refresh-demo.yml

    let DEMO_DATA = null;

    async function loadDemoData() {
        // Priority 1: Inline script tag (instant, works from file://)
        if (window.ENGRAM_DEMO_DATA) {
            DEMO_DATA = window.ENGRAM_DEMO_DATA;
            return DEMO_DATA;
        }

        // Priority 2: Fetch JSON (HTTP/HTTPS deployments)
        try {
            const res = await fetch('demo-data.json');
            if (res.ok) {
                DEMO_DATA = await res.json();
                return DEMO_DATA;
            }
        } catch (e) {}

        throw new Error('Demo data not available. Ensure demo-data.js or demo-data.json exists.');
    }

    // Get content for a skill/memory by org+repo+path
    function getContent(org, repo, path) {
        const pool = repo === '.memory' ? DEMO_DATA.memories : DEMO_DATA.skills;
        const item = pool.find(s => s.org === org && s.repo === repo && s.path === path);
        return item ? item.content : null;
    }

    // Simple markdown to HTML renderer (no external deps)
    function renderMarkdown(md) {
        md = md.replace(/^---[\s\S]*?---\n*/m, '');
        let html = md;
        html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) =>
            '<pre><code>' + escapeHtml(code.trim()) + '</code></pre>');
        html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
        html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
        html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
        html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
        html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
        html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
        html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
        html = html.replace(/^---$/gm, '<hr>');
        html = html.replace(/^(\|.+\|)\n(\|[-:| ]+\|)\n((?:\|.+\|\n?)*)/gm, (_, header, sep, body) => {
            const ths = header.split('|').filter(c => c.trim()).map(c => '<th>' + c.trim() + '</th>').join('');
            const rows = body.trim().split('\n').map(row => {
                const tds = row.split('|').filter(c => c.trim()).map(c => '<td>' + c.trim() + '</td>').join('');
                return '<tr>' + tds + '</tr>';
            }).join('');
            return '<table><thead><tr>' + ths + '</tr></thead><tbody>' + rows + '</tbody></table>';
        });
        html = html.replace(/^((?:- .+\n?)+)/gm, (match) => {
            const items = match.trim().split('\n').map(l =>
                '<li>' + l.replace(/^- /, '') + '</li>').join('');
            return '<ul>' + items + '</ul>';
        });
        html = html.replace(/^((?:\d+\. .+\n?)+)/gm, (match) => {
            const items = match.trim().split('\n').map(l =>
                '<li>' + l.replace(/^\d+\. /, '') + '</li>').join('');
            return '<ol>' + items + '</ol>';
        });
        html = html.replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>');
        html = html.split('\n\n').map(block => {
            block = block.trim();
            if (!block) return '';
            if (/^<[a-z]/.test(block)) return block;
            return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
        }).join('\n');
        return html;
    }

    function escapeHtml(str) {
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function parseFrontmatter(md) {
        const match = md.match(/^---\n([\s\S]*?)\n---/);
        if (!match) return {};
        const fm = {};
        match[1].split('\n').forEach(line => {
            const m = line.match(/^(\w+):\s*"?([^"]*)"?\s*$/);
            if (m) {
                let val = m[2].trim();
                if (/^-?\d+$/.test(val)) val = parseInt(val);
                else if (/^-?\d+\.\d+$/.test(val)) val = parseFloat(val);
                fm[m[1]] = val;
            }
        });
        return fm;
    }

    function wordCount(text) {
        return text.replace(/```[\s\S]*?```/g, '').replace(/[#*`|>-]/g, '').trim().split(/\s+/).length;
    }

    // Our real orgs where .skills/.memory files actually exist on GitHub
    const REAL_ORGS = new Set(['engram-hq', 'sreniatnoc', 'ARTIFACTIQ']);
    function isRealOrg(org) { return REAL_ORGS.has(org); }

    // ==========================================
    // Build tree from embedded data
    // ==========================================
    function buildTree() {
        const tree = [];
        const byKey = {};

        for (const skill of DEMO_DATA.skills) {
            const key = skill.org + '/' + skill.repo + '/' + skill.tier;
            if (!byKey[key]) {
                const repoType = skill.repo === '.memory' ? 'memory' : (skill.tier === 3 ? 'project' : 'skills');
                byKey[key] = { org: skill.org, tier: skill.tier, repo: skill.repo, repoType, files: [] };
                tree.push(byKey[key]);
            }
            byKey[key].files.push({ name: skill.name, path: skill.path });
        }

        return tree;
    }

    // ==========================================
    // Render tree UI
    // ==========================================
    function renderTree(tree) {
        const container = document.getElementById('tree-content');
        container.innerHTML = '';

        if (tree.length === 0) {
            container.innerHTML = '<div class="demo-empty">No skills found.</div>';
            return;
        }

        const byOrg = {};
        for (const entry of tree) {
            if (!byOrg[entry.org]) byOrg[entry.org] = [];
            byOrg[entry.org].push(entry);
        }

        for (const [org, entries] of Object.entries(byOrg)) {
            const orgDiv = document.createElement('div');
            orgDiv.className = 'tree-org';

            const orgLabel = document.createElement('div');
            orgLabel.className = 'tree-org-label';
            orgLabel.innerHTML = '<span class="arrow open">&#9654;</span><span class="org-icon">&#127970;</span> ' + org;

            const filesContainer = document.createElement('div');
            filesContainer.className = 'tree-files open';

            for (const entry of entries) {
                const repoHeader = document.createElement('div');
                repoHeader.className = 'tree-file';
                repoHeader.style.fontWeight = '600';
                repoHeader.style.color = 'var(--text)';
                repoHeader.style.cursor = 'default';
                repoHeader.style.marginTop = '0.25rem';
                const tierClass = entry.tier === 2 ? 't2' : 't3';
                const tierLabel = entry.tier === 2 ? 'T2' : 'T3';
                repoHeader.innerHTML =
                    '<span class="file-icon">&#128193;</span> ' + entry.repo +
                    ' <span class="tier-badge-sm ' + tierClass + '">' + tierLabel + '</span>';
                filesContainer.appendChild(repoHeader);

                for (const file of entry.files) {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'tree-file';
                    const icon = entry.repoType === 'memory' ? '&#128218;' : '&#9889;';
                    fileDiv.innerHTML = '<span class="file-icon">' + icon + '</span> ' + file.name;
                    fileDiv.addEventListener('click', () => {
                        document.querySelectorAll('.tree-file.active').forEach(el => el.classList.remove('active'));
                        fileDiv.classList.add('active');
                        loadFile(entry.org, entry.repo, file.path, entry.tier, entry.repoType);
                    });
                    filesContainer.appendChild(fileDiv);
                }
            }

            orgLabel.addEventListener('click', () => {
                filesContainer.classList.toggle('open');
                orgLabel.querySelector('.arrow').classList.toggle('open');
            });

            orgDiv.appendChild(orgLabel);
            orgDiv.appendChild(filesContainer);
            container.appendChild(orgDiv);
        }
    }

    // ==========================================
    // Load and render a file
    // ==========================================
    function loadFile(org, repo, path, tier, repoType) {
        const viewer = document.getElementById('demo-viewer');
        const content = getContent(org, repo, path);
        if (!content) {
            viewer.innerHTML = '<div class="demo-error">Content not found.</div>';
            return;
        }

        const fm = parseFrontmatter(content);
        const words = wordCount(content);
        const tierLbl = tier === 2 ? 'Tier 2 - Org' : 'Tier 3 - Repo';
        const tierClass = tier === 2 ? 't2' : 't3';
        const typeIcon = repoType === 'memory' ? '&#128218;' : '&#9889;';
        const real = isRealOrg(org);
        const ghUrl = real ? 'https://github.com/' + org + '/' + repo + '/blob/main/' + path : '';
        const repoUrl = org.includes('/') ? 'https://github.com/' + org : '';

        let metaTags = '';
        metaTags += '<span class="meta-tag">' + typeIcon + ' ' + (repoType === 'memory' ? 'Memory' : 'Skill') + '</span>';
        metaTags += '<span class="meta-tag tier-badge-sm ' + tierClass + '">' + tierLbl + '</span>';
        metaTags += '<span class="meta-tag">&#127970; ' + org + '</span>';
        if (fm.last_updated) metaTags += '<span class="meta-tag">&#128197; ' + fm.last_updated + '</span>';
        if (!real) metaTags += '<span class="meta-tag" style="color:#fbbf24;">Auto-generated</span>';

        const title = fm.name || path.split('/').pop().replace('.md', '');

        const shareUrl = ghUrl || repoUrl || 'https://engram-hq.github.io/releases/';
        const shareText = title + ' - ' + org + '/' + repo + ' (' + tierLbl + ', ' + words + ' words)';
        viewer.innerHTML =
            '<div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;"><h3 style="margin:0;">' + title + '</h3>' +
            '<button class="share-btn" onclick="shareContent(\'' + escapeHtml(title) + '\', \'' + escapeHtml(shareText) + '\', \'' + escapeHtml(shareUrl) + '\')">&#8599; Share</button></div>' +
            '<div class="meta">' + metaTags + '</div>' +
            '<div class="word-count">' + words.toLocaleString() + ' words &middot; ' + org + '/' + repo + '/' + path + '</div>' +
            '<div class="rendered-md">' + renderMarkdown(content) + '</div>' +
            (real ? '<a class="gh-link" href="' + ghUrl + '" target="_blank">&#128279; View on GitHub</a>'
                  : (repoUrl ? '<a class="gh-link" href="' + repoUrl + '" target="_blank">&#128279; View repo on GitHub</a>' : ''));
    }

    // ==========================================
    // Tab switching
    // ==========================================
    const tabLoaded = { skills: true, timeline: false, search: false, analytics: false, sync: false };

    function switchDemoTab(tab) {
        document.querySelectorAll('.demo-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.demo-tab-panel').forEach(p => p.classList.remove('active'));
        document.querySelector('.demo-tab[data-tab="' + tab + '"]').classList.add('active');
        document.getElementById('panel-' + tab).classList.add('active');

        // Timeline is fullscreen overlay - lock body scroll
        if (tab === 'timeline') {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = '';
        }

        if (!tabLoaded[tab]) {
            tabLoaded[tab] = true;
            if (tab === 'timeline') initTimelineGraph();
            else if (tab === 'search') initSearch();
            else if (tab === 'analytics') initAnalytics();
            else if (tab === 'sync') initSync();
        }

        // Resize graph when re-entering timeline
        if (tab === 'timeline' && window._tlGraph) {
            const c = document.getElementById('tl-graph-container');
            setTimeout(() => {
                window._tlGraph.width(c.clientWidth);
                window._tlGraph.height(c.clientHeight);
            }, 50);
        }
    }

    function closeTimeline() {
        // Return to skills tab
        switchDemoTab('skills');
        document.body.style.overflow = '';
        // Scroll back to demo section
        document.getElementById('demo').scrollIntoView({ behavior: 'smooth' });
    }

    // Esc key closes fullscreen timeline
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.getElementById('panel-timeline').classList.contains('active')) {
            closeTimeline();
        }
    });

    // ==========================================
    // 3D Timeline Graph
    // ==========================================
    let allMemories = [];
    let _tlOrgTree = {};
    const ORG_COLORS = {
        'engram-hq': '#a78bfa', 'sreniatnoc': '#22d3ee', 'ARTIFACTIQ': '#f59e0b',
        'mlOS-foundation': '#f472b6', 'traceloop-ai': '#34d399', 'reccaller-ai': '#fb923c',
        'prepguides': '#60a5fa', 'go-foundations': '#a3e635', 'fedai-oss': '#c084fc',
        'ishaileshpant': '#fbbf24',
    };
    const DEFAULT_NODE_COLOR = '#4ade80';

    function buildMemories() {
        if (allMemories.length > 0) return allMemories;
        for (const mem of DEMO_DATA.memories) {
            const fm = parseFrontmatter(mem.content);
            const body = mem.content.replace(/^---[\s\S]*?---\n*/m, '');
            const titleMatch = body.match(/^# (.+)$/m);
            const summaryMatch = body.match(/## Summary\n\n([^\n]+)/);
            allMemories.push({
                id: 'mem-' + allMemories.length,
                org: mem.org,
                file: { name: mem.name, path: mem.path },
                content: mem.content,
                date: fm.date || mem.name.match(/^(\d{4}-\d{2}-\d{2})/)?.[1] || 'unknown',
                title: (titleMatch ? titleMatch[1] : mem.name.replace('.md', '').replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/-/g, ' ')).replace('Session: ', ''),
                summary: summaryMatch ? summaryMatch[1].replace(/\*\*/g, '').slice(0, 200) : '',
                goal: fm.goal || '',
                repo: fm.repo || '',
                model: fm.model || '',
                type: fm.type || 'session',
                words: wordCount(mem.content),
                cost: fm.cost_usd ? parseFloat(fm.cost_usd) : null,
                inputTokens: fm.input_tokens ? parseInt(fm.input_tokens) : null,
                outputTokens: fm.output_tokens ? parseInt(fm.output_tokens) : null,
                apiCalls: fm.api_calls ? parseInt(fm.api_calls) : null,
                chronoIndex: mem.chronoIndex || null,
            });
        }
        allMemories.sort((a, b) => a.date.localeCompare(b.date));
        return allMemories;
    }

    function initTimelineGraph() {
        if (typeof ForceGraph3D === 'undefined') {
            setTimeout(initTimelineGraph, 500);
            return;
        }

        // Destroy previous graph instance if rebuilding
        const gc = document.getElementById('tl-graph-container');
        if (window._tlGraph) {
            try { window._tlGraph._destructor(); } catch(e) {}
            window._tlGraph = null;
        }
        // Remove leftover DOM elements from previous graph
        gc.querySelectorAll('canvas, .scene-tooltip, .graph-tooltip, .tl-legend, .scene-nav-info').forEach(el => el.remove());

        const memories = buildMemories();

        // Build skills data
        const skills = DEMO_DATA.skills.map((sk, i) => {
            const fm = parseFrontmatter(sk.content);
            return {
                id: 'skill-' + i, nodeType: 'skill',
                org: sk.org, repo: sk.repo, tier: sk.tier, path: sk.path,
                name: fm.name || sk.name.replace('.md', ''),
                words: wordCount(sk.content), content: sk.content,
                chronoIndex: sk.chronoIndex || null,
            };
        });

        // Build org tree for left panel
        _tlOrgTree = {};
        for (const m of memories) {
            if (!_tlOrgTree[m.org]) _tlOrgTree[m.org] = { sessions: [], repos: new Set() };
            _tlOrgTree[m.org].sessions.push(m);
            if (m.repo) m.repo.split(',').forEach(r => _tlOrgTree[m.org].repos.add(r.trim()));
        }
        for (const s of skills) {
            if (!_tlOrgTree[s.org]) _tlOrgTree[s.org] = { sessions: [], repos: new Set() };
            _tlOrgTree[s.org].repos.add(s.repo);
        }
        renderOrgTree(null);

        // Build graph nodes
        const uniqueDates = [...new Set(memories.map(m => m.date))].sort();
        const orgKeys = Object.keys(_tlOrgTree);
        const nodes = [];
        const links = [];
        const maxCost = Math.max(...memories.map(m => m.cost || 0), 1);

        // Session (memory) nodes - spheres, sized by cost (log scale for proportional sizing)
        for (const m of memories) {
            const dateIdx = uniqueDates.indexOf(m.date);
            const orgIdx = orgKeys.indexOf(m.org);
            const costRatio = m.cost ? m.cost / maxCost : 0;
            // Log scale: $0.50 -> ~1, $5 -> ~2, $50 -> ~3, $150 -> ~3.5
            const sizeVal = m.cost ? Math.max(0.8, Math.log10(m.cost + 1) * 1.5) : Math.max(0.6, Math.min(2, m.words / 500));
            nodes.push({
                id: m.id, nodeType: 'session', name: m.title, org: m.org,
                date: m.date, cost: m.cost, model: m.model, words: m.words,
                inputTokens: m.inputTokens, outputTokens: m.outputTokens, apiCalls: m.apiCalls,
                val: sizeVal,
                color: ORG_COLORS[m.org] || DEFAULT_NODE_COLOR,
                costRatio: costRatio,
                x: (dateIdx / Math.max(uniqueDates.length - 1, 1) - 0.5) * 280,
                y: (orgIdx - orgKeys.length / 2) * 80,
                z: (Math.random() - 0.5) * 100,
                chronoIndex: m.chronoIndex,
                memData: m,
            });
        }

        // Skill nodes - diamond/octahedron shape, smaller than sessions
        for (const s of skills) {
            const orgIdx = orgKeys.indexOf(s.org);
            nodes.push({
                id: s.id, nodeType: 'skill', name: s.name, org: s.org,
                words: s.words, val: Math.max(0.3, Math.min(1.2, s.words / 800)),
                color: ORG_COLORS[s.org] || DEFAULT_NODE_COLOR,
                costRatio: 0,
                x: (Math.random() - 0.5) * 200,
                y: (orgIdx - orgKeys.length / 2) * 80 + (Math.random() - 0.5) * 50,
                z: (Math.random() - 0.5) * 100,
                chronoIndex: s.chronoIndex,
                skillData: s,
            });
        }

        // Links: session-to-session chronological (strong neural pathways)
        const byOrg = {};
        for (const m of memories) {
            if (!byOrg[m.org]) byOrg[m.org] = [];
            byOrg[m.org].push(m);
        }
        for (const [org, orgMems] of Object.entries(byOrg)) {
            const c = ORG_COLORS[org] || DEFAULT_NODE_COLOR;
            orgMems.sort((a, b) => a.date.localeCompare(b.date));
            for (let i = 0; i < orgMems.length - 1; i++) {
                links.push({
                    source: orgMems[i].id, target: orgMems[i + 1].id,
                    dimColor: c + '12', particleColor: c,
                    particles: 8, particleWidth: 3.2, speed: 0.012,
                    width: 1.8, linkType: 'synapse',
                });
            }
        }

        // Links: skill-to-session (knowledge dendrites - thinner, slower)
        // Also link skills to each other within orgs that have no sessions
        const skillsByOrg = {};
        for (const s of skills) {
            if (!skillsByOrg[s.org]) skillsByOrg[s.org] = [];
            skillsByOrg[s.org].push(s);
        }
        for (const s of skills) {
            const orgSessions = byOrg[s.org] || [];
            const c = ORG_COLORS[s.org] || DEFAULT_NODE_COLOR;
            if (orgSessions.length > 0) {
                links.push({
                    source: s.id, target: orgSessions[orgSessions.length - 1].id,
                    dimColor: c + '08', particleColor: c + 'bb',
                    particles: 3, particleWidth: 1.8, speed: 0.005,
                    width: 0.6, linkType: 'dendrite',
                });
                if (orgSessions.length > 1) {
                    links.push({
                        source: s.id, target: orgSessions[0].id,
                        dimColor: c + '06', particleColor: c + '88',
                        particles: 2, particleWidth: 1.2, speed: 0.004,
                        width: 0.3, linkType: 'dendrite',
                    });
                }
            }
        }
        // Chain skill nodes together for orgs with no sessions (prevents dangling)
        for (const [org, orgSkills] of Object.entries(skillsByOrg)) {
            if ((byOrg[org] || []).length > 0) continue; // has sessions, already linked
            const c = ORG_COLORS[org] || DEFAULT_NODE_COLOR;
            for (let i = 0; i < orgSkills.length - 1; i++) {
                links.push({
                    source: orgSkills[i].id, target: orgSkills[i + 1].id,
                    dimColor: c + '10', particleColor: c + 'aa',
                    particles: 4, particleWidth: 2, speed: 0.006,
                    width: 0.8, linkType: 'dendrite',
                });
            }
        }

        // chronoIndex is pre-computed per-org in demo-data by refresh-demo-data.py

        // Init 3D graph
        const container = document.getElementById('tl-graph-container');
        document.getElementById('timeline-loading').style.display = 'none';

        const graph = ForceGraph3D()(container)
            .graphData({ nodes, links })
            .backgroundColor('#020205')
            .width(container.clientWidth)
            .height(container.clientHeight)

            // Nodes - smaller, proportional sizing
            .nodeRelSize(4)
            .nodeVal(n => n.val)
            .nodeColor(n => n.color)
            .nodeOpacity(0.92)
            .nodeResolution(16)
            .nodeLabel(node => {
                const icon = node.nodeType === 'skill' ? '&#9889;' : '&#128218;';
                const bg = node.nodeType === 'session' ? 'rgba(9,9,11,0.96)' : 'rgba(9,9,11,0.92)';
                let html = '<div style="background:' + bg + ';padding:10px 14px;border-radius:10px;border:1px solid ' + node.color + '44;color:#fafafa;font-size:13px;max-width:280px;font-family:-apple-system,sans-serif;box-shadow:0 0 20px ' + node.color + '22;">';
                html += '<div style="font-weight:700;margin-bottom:4px;color:' + node.color + ';">' + icon + ' ' + node.name + '</div>';
                if (node.nodeType === 'session') {
                    html += '<div style="color:#a1a1aa;font-size:11px;margin-bottom:2px;">' + node.date + ' &middot; ' + node.org + '</div>';
                    if (node.cost !== null) {
                        const barWidth = Math.round(node.costRatio * 100);
                        html += '<div style="margin:5px 0;"><div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:2px;"><span style="color:#a1a1aa;">Cost</span><span style="color:' + node.color + ';font-weight:700;">$' + node.cost.toFixed(2) + '</span></div>';
                        html += '<div style="background:rgba(255,255,255,0.06);border-radius:3px;height:4px;overflow:hidden;"><div style="width:' + barWidth + '%;height:100%;background:' + node.color + ';border-radius:3px;"></div></div></div>';
                    }
                    if (node.model) html += '<div style="color:#71717a;font-size:10px;">Model: ' + node.model.replace('claude-', '') + '</div>';
                    if (node.inputTokens) html += '<div style="color:#71717a;font-size:10px;">Tokens: ' + (node.inputTokens / 1000).toFixed(0) + 'K in &middot; ' + (node.outputTokens / 1000).toFixed(0) + 'K out</div>';
                    if (node.apiCalls) html += '<div style="color:#71717a;font-size:10px;">' + node.apiCalls + ' API calls &middot; ' + node.words.toLocaleString() + ' words</div>';
                    else html += '<div style="color:#71717a;font-size:10px;">' + node.words.toLocaleString() + ' words</div>';
                } else {
                    html += '<div style="color:#a1a1aa;font-size:11px;">' + node.org + ' &middot; Tier ' + (node.skillData ? node.skillData.tier : '2') + ' Skill</div>';
                    html += '<div style="color:#71717a;font-size:10px;">' + node.words.toLocaleString() + ' words</div>';
                }
                html += '</div>';
                return html;
            })

            // Links - dim pathways with bright flowing particles
            .linkCurvature(l => l.linkType === 'synapse' ? 0.2 : 0.35)
            .linkWidth(l => l.width)
            .linkOpacity(0.06)
            .linkColor(l => l.dimColor)

            // Particles - neural signals flowing through synapses
            .linkDirectionalParticles(l => l.particles)
            .linkDirectionalParticleWidth(l => l.particleWidth)
            .linkDirectionalParticleSpeed(l => l.speed)
            .linkDirectionalParticleColor(l => l.particleColor)
            .linkDirectionalParticleResolution(12)

            // No arrows - particles show direction
            .linkDirectionalArrowLength(0)

            .onNodeClick(node => {
                if (node.nodeType === 'session' && node.memData) {
                    loadMemory(node.memData);
                } else if (node.nodeType === 'skill' && node.skillData) {
                    loadSkillInDetail(node.skillData);
                }
                flyToNode(graph, node);
            })
            .onNodeHover(node => {
                container.style.cursor = node ? 'pointer' : 'default';
            })
            .warmupTicks(60)
            .cooldownTicks(80)
            .d3AlphaDecay(0.04)
            .d3VelocityDecay(0.4);

        // Custom node rendering: spheres for memories, octahedrons for skills
        try {
            const THREE = window.THREE || graph.scene().constructor;
            if (THREE && THREE.MeshLambertMaterial) {
                // Cache geometries and materials
                const matCache = {};
                function getMat(color, emissive) {
                    const key = color + emissive;
                    if (matCache[key]) return matCache[key];
                    const c = new THREE.Color(color);
                    const m = new THREE.MeshLambertMaterial({
                        color: c,
                        emissive: new THREE.Color(emissive || color),
                        emissiveIntensity: 0.4,
                        transparent: true,
                        opacity: 0.85,
                    });
                    matCache[key] = m;
                    return m;
                }

                const sphereGeo = new THREE.SphereGeometry(1, 16, 12);
                const octaGeo = new THREE.OctahedronGeometry(1, 0);

                // Helper: create a canvas-based number sprite
                function makeNumberSprite(num, color) {
                    const canvas = document.createElement('canvas');
                    canvas.width = 128;
                    canvas.height = 128;
                    const ctx = canvas.getContext('2d');
                    // Dark background disc for contrast
                    ctx.beginPath();
                    ctx.arc(64, 64, 52, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(2,2,5,0.85)';
                    ctx.fill();
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = color;
                    ctx.globalAlpha = 0.6;
                    ctx.stroke();
                    // Number text
                    ctx.globalAlpha = 1.0;
                    ctx.font = 'bold 56px -apple-system, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.shadowColor = color;
                    ctx.shadowBlur = 12;
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText(String(num), 64, 66);
                    const texture = new THREE.CanvasTexture(canvas);
                    texture.needsUpdate = true;
                    const spriteMat = new THREE.SpriteMaterial({ map: texture, transparent: true, depthTest: false, sizeAttenuation: true });
                    const sprite = new THREE.Sprite(spriteMat);
                    return sprite;
                }

                graph.nodeThreeObject(node => {
                    const radius = Math.cbrt(node.val || 1) * 3.5;
                    const mat = getMat(node.color, node.color);
                    const group = new THREE.Group();
                    let mesh;
                    if (node.nodeType === 'skill') {
                        mesh = new THREE.Mesh(octaGeo, mat);
                        mesh.scale.set(radius * 0.8, radius * 1.2, radius * 0.8);
                    } else {
                        mesh = new THREE.Mesh(sphereGeo, mat);
                        mesh.scale.set(radius, radius, radius);
                    }
                    group.add(mesh);

                    // Add chronological number as superscript sprite
                    if (node.chronoIndex) {
                        const numSprite = makeNumberSprite(node.chronoIndex, node.color);
                        const badgeSize = Math.max(radius * 2.2, 6);
                        numSprite.scale.set(badgeSize, badgeSize, 1);
                        numSprite.position.set(radius * 1.2, radius * 1.4, 0);
                        numSprite.renderOrder = 999;
                        group.add(numSprite);
                    }
                    return group;
                });
                graph.nodeThreeObjectExtend(false);

                // Add ambient and point light for the materials
                const scene = graph.scene();
                if (scene) {
                    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
                    const pt = new THREE.PointLight(0xffffff, 0.8);
                    pt.position.set(200, 200, 200);
                    scene.add(pt);
                }
            }
        } catch(e) { console.warn('[Engram] Custom THREE.js shapes failed:', e); }

        // Scene fog for depth
        try {
            const scene = graph.scene();
            if (scene && scene.fog === null) {
                if (window.THREE) scene.fog = new THREE.FogExp2('#020205', 0.0015);
            }
        } catch(e) {}

        // Camera & controls - gentle auto-rotate, no fighting with fly-to
        const controls = graph.controls();
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.15;
        controls.enableDamping = true;
        controls.dampingFactor = 0.15;

        // Set initial camera after simulation settles
        setTimeout(() => {
            graph.cameraPosition({ x: 50, y: 80, z: 300 }, { x: 0, y: 0, z: 0 }, 0);
        }, 200);

        // Legend overlay with metric explanations
        const legend = document.createElement('div');
        legend.className = 'tl-legend';
        let legendHtml = '<div style="display:flex;flex-direction:column;gap:6px;">';
        legendHtml += '<div style="display:flex;flex-wrap:wrap;gap:6px;">';
        for (const [org, color] of Object.entries(ORG_COLORS)) {
            if (_tlOrgTree[org]) {
                legendHtml += '<div class="tl-legend-item"><span class="tl-legend-dot" style="background:' + color + ';box-shadow:0 0 6px ' + color + ';"></span>' + org + '</div>';
            }
        }
        legendHtml += '</div>';
        legendHtml += '<div style="font-size:0.62rem;color:rgba(255,255,255,0.35);border-top:1px solid rgba(255,255,255,0.06);padding-top:4px;">&#9679; Sphere = Memory &middot; &#9670; Diamond = Skill &middot; Number = per-org sequence &middot; Size = cost &middot; Particles = data flow</div>';
        legendHtml += '</div>';
        legend.innerHTML = legendHtml;
        container.appendChild(legend);

        // Store graph ref
        window._tlGraph = graph;

        // Handle resize
        const ro = new ResizeObserver(() => {
            graph.width(container.clientWidth);
            graph.height(container.clientHeight);
        });
        ro.observe(container);

        // Auto-select first session
        if (memories.length > 0) loadMemory(memories[0]);
    }

    function renderOrgTree(activeFilter) {
        const container = document.getElementById('tl-org-tree');
        if (!container) return;
        let html = '';

        // "All" filter
        const totalSessions = Object.values(_tlOrgTree).reduce((a, b) => a + b.sessions.length, 0);
        html += '<div class="tl-org-item' + (!activeFilter ? ' active' : '') + '" onclick="filterGraph(null)">' +
            '<span><span class="tl-org-dot" style="background:#a1a1aa;"></span> All</span>' +
            '<span class="tl-count">' + totalSessions + '</span></div>';

        for (const [org, data] of Object.entries(_tlOrgTree)) {
            const color = ORG_COLORS[org] || DEFAULT_NODE_COLOR;
            const countLabel = data.sessions.length > 0 ? data.sessions.length : (data.repos.size + ' repos');
            html += '<div class="tl-org-item' + (activeFilter === org ? ' active' : '') + '" onclick="filterGraph(\'' + org + '\')">' +
                '<span><span class="tl-org-dot" style="background:' + color + ';"></span> ' + org + '</span>' +
                '<span class="tl-count">' + countLabel + '</span></div>';

            html += '<div class="tl-session-list">';
            for (const s of data.sessions) {
                html += '<div class="tl-session-item" onclick="event.stopPropagation(); focusNode(\'' + s.id + '\')" title="' + escapeHtml(s.title) + '">' + escapeHtml(s.title) + '</div>';
            }
            html += '</div>';
        }

        container.innerHTML = html;
    }

    function filterGraph(org) {
        if (!window._tlGraph) return;
        window._tlGraph
            .nodeVisibility(n => !org || n.org === org)
            .linkVisibility(l => {
                if (!org) return true;
                const src = typeof l.source === 'object' ? l.source : null;
                const tgt = typeof l.target === 'object' ? l.target : null;
                return src && tgt && src.org === org && tgt.org === org;
            });
        renderOrgTree(org);
    }

    // Fly camera to a node - pauses auto-rotate to prevent fighting
    function flyToNode(graph, node) {
        if (!graph || !node) return;
        const controls = graph.controls();

        // Pause auto-rotate during animation
        if (controls) controls.autoRotate = false;

        // Calculate camera position: offset from node, handle origin case
        const nx = node.x || 0, ny = node.y || 0, nz = node.z || 0;
        const dist = 100;
        const hyp = Math.hypot(nx, ny, nz);
        let camPos;
        if (hyp < 1) {
            // Node is near origin - position camera in front
            camPos = { x: 0, y: 0, z: dist };
        } else {
            const ratio = 1 + dist / hyp;
            camPos = { x: nx * ratio, y: ny * ratio, z: nz * ratio };
        }

        graph.cameraPosition(camPos, node, 800);

        // Resume auto-rotate after animation completes
        setTimeout(() => {
            if (controls) controls.autoRotate = true;
        }, 1200);
    }

    function focusNode(nodeId) {
        if (!window._tlGraph) return;
        const gdata = window._tlGraph.graphData();
        const node = gdata.nodes.find(n => n.id === nodeId);
        if (!node) return;

        flyToNode(window._tlGraph, node);

        if (node.memData) loadMemory(node.memData);
        else if (node.skillData) loadSkillInDetail(node.skillData);
    }

    function loadMemory(mem) {
        const panel = document.getElementById('tl-detail-panel');
        const content = mem.content || '';
        if (!content) { panel.innerHTML = '<div class="tl-placeholder"><p>Content not found.</p></div>'; return; }

        const fm = parseFrontmatter(content);
        const real = isRealOrg(mem.org);
        const ghUrl = real ? 'https://github.com/' + mem.org + '/.memory/blob/main/' + mem.file.path : '';
        const repoUrl = mem.org.includes('/') ? 'https://github.com/' + mem.org : '';
        const shareUrl = ghUrl || repoUrl || 'https://engram-hq.github.io/releases/';

        // Metrics grid
        let metrics = '<div class="tl-metrics">';
        metrics += '<div class="tl-metric-card"><div class="label">Date</div><div class="value">' + (fm.date || mem.date || '-') + '</div></div>';
        metrics += '<div class="tl-metric-card"><div class="label">Org</div><div class="value">' + mem.org + '</div></div>';
        if (fm.model) metrics += '<div class="tl-metric-card"><div class="label">Model</div><div class="value">' + fm.model.replace('claude-', '').replace(/-/g, ' ') + '</div></div>';
        if (fm.cost_usd) metrics += '<div class="tl-metric-card"><div class="label">Cost</div><div class="value" style="color:var(--primary-light);">$' + parseFloat(fm.cost_usd).toFixed(2) + '</div></div>';
        if (fm.api_calls) metrics += '<div class="tl-metric-card"><div class="label">API Calls</div><div class="value">' + parseInt(fm.api_calls).toLocaleString() + '</div></div>';
        metrics += '<div class="tl-metric-card"><div class="label">Words</div><div class="value">' + mem.words.toLocaleString() + '</div></div>';
        if (fm.input_tokens) {
            metrics += '<div class="tl-metric-card"><div class="label">Input</div><div class="value">' + (parseInt(fm.input_tokens) / 1000).toFixed(0) + 'K tok</div></div>';
            metrics += '<div class="tl-metric-card"><div class="label">Output</div><div class="value">' + (parseInt(fm.output_tokens) / 1000).toFixed(0) + 'K tok</div></div>';
        }
        metrics += '</div>';

        const shareText = mem.title + ' - ' + mem.org + ' session';
        const linkHtml = real
            ? '<a style="display:inline-block;margin-top:0.75rem;font-size:0.8rem;color:var(--primary-light);" href="' + ghUrl + '" target="_blank">&#128279; View on GitHub</a>'
            : (repoUrl ? '<a style="display:inline-block;margin-top:0.75rem;font-size:0.8rem;color:var(--primary-light);" href="' + repoUrl + '" target="_blank">&#128279; View repo on GitHub</a>' : '');
        panel.innerHTML =
            '<div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">' +
            '<h3 style="margin:0;flex:1;font-size:0.95rem;">' + escapeHtml(mem.title) + '</h3>' +
            '<button class="share-btn" onclick="shareContent(\'' + escapeHtml(mem.title) + '\', \'' + escapeHtml(shareText) + '\', \'' + escapeHtml(shareUrl) + '\')">&#8599;</button></div>' +
            (fm.goal ? '<p style="color:var(--text-muted);font-style:italic;font-size:0.8rem;margin-bottom:0.75rem;">Goal: ' + fm.goal + '</p>' : '') +
            metrics +
            '<div class="tl-detail-content">' + renderMarkdown(content) + '</div>' +
            linkHtml;
    }

    function loadSkillInDetail(skill) {
        const panel = document.getElementById('tl-detail-panel');
        const fm = parseFrontmatter(skill.content);
        const real = isRealOrg(skill.org);
        const ghUrl = real ? 'https://github.com/' + skill.org + '/' + skill.repo + '/blob/main/' + skill.path : '';
        const repoUrl = skill.org.includes('/') ? 'https://github.com/' + skill.org : '';

        let metrics = '<div class="tl-metrics">';
        metrics += '<div class="tl-metric-card"><div class="label">Org</div><div class="value">' + skill.org + '</div></div>';
        metrics += '<div class="tl-metric-card"><div class="label">Repo</div><div class="value">' + skill.repo + '</div></div>';
        metrics += '<div class="tl-metric-card"><div class="label">Tier</div><div class="value">Tier ' + skill.tier + '</div></div>';
        metrics += '<div class="tl-metric-card"><div class="label">Words</div><div class="value">' + skill.words.toLocaleString() + '</div></div>';
        metrics += '</div>';

        const linkHtml = real
            ? '<a style="display:inline-block;margin-top:0.75rem;font-size:0.8rem;color:var(--primary-light);" href="' + ghUrl + '" target="_blank">&#128279; View on GitHub</a>'
            : (repoUrl ? '<a style="display:inline-block;margin-top:0.75rem;font-size:0.8rem;color:var(--primary-light);" href="' + repoUrl + '" target="_blank">&#128279; View repo on GitHub</a>' : '');
        panel.innerHTML =
            '<h3 style="font-size:0.95rem;">&#9889; ' + escapeHtml(skill.name) + '</h3>' +
            metrics +
            '<div class="tl-detail-content">' + renderMarkdown(skill.content) + '</div>' +
            linkHtml;
    }

    // ==========================================
    // Full-Text Search
    // ==========================================
    let searchFilter = 'all';
    let searchIndex = []; // { type, title, org, repo, tier, path, content, words }

    function initSearch() {
        searchIndex = [];
        for (const s of DEMO_DATA.skills) {
            const fm = parseFrontmatter(s.content);
            searchIndex.push({
                type: 'skill', title: fm.name || s.name.replace('.md', ''),
                org: s.org, repo: s.repo, tier: s.tier, path: s.path,
                content: s.content, words: wordCount(s.content),
            });
        }
        for (const m of DEMO_DATA.memories) {
            const fm = parseFrontmatter(m.content);
            const body = m.content.replace(/^---[\s\S]*?---\n*/m, '');
            const titleMatch = body.match(/^# (.+)$/m);
            searchIndex.push({
                type: 'memory', title: titleMatch ? titleMatch[1] : m.name.replace('.md', '').replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/-/g, ' '),
                org: m.org, repo: '.memory', tier: 2, path: m.path,
                content: m.content, words: wordCount(m.content), date: fm.date || '',
            });
        }
        document.getElementById('search-input').focus();
    }

    function setSearchFilter(filter) {
        searchFilter = filter;
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        document.querySelector('.filter-chip[data-filter="' + filter + '"]').classList.add('active');
        runSearch();
    }

    function runSearch() {
        const query = document.getElementById('search-input').value.trim().toLowerCase();
        const resultsDiv = document.getElementById('search-results');
        const countDiv = document.getElementById('search-count');

        if (!query || query.length < 2) {
            resultsDiv.innerHTML = '<div class="search-empty">Type at least 2 characters to search across all skills and memories.</div>';
            countDiv.textContent = '';
            return;
        }

        const terms = query.split(/\s+/);
        let results = [];

        for (const item of searchIndex) {
            if (searchFilter !== 'all' && item.type !== searchFilter) continue;
            const text = (item.title + ' ' + item.content).toLowerCase();
            const allMatch = terms.every(t => text.includes(t));
            if (!allMatch) continue;

            // Find best snippet
            const plainContent = item.content.replace(/^---[\s\S]*?---\n*/m, '').replace(/[#*`|>-]/g, '');
            let bestSnippet = '';
            const idx = plainContent.toLowerCase().indexOf(terms[0]);
            if (idx >= 0) {
                const start = Math.max(0, idx - 80);
                const end = Math.min(plainContent.length, idx + 200);
                bestSnippet = (start > 0 ? '...' : '') + plainContent.slice(start, end).trim() + (end < plainContent.length ? '...' : '');
            } else {
                bestSnippet = plainContent.slice(0, 200).trim() + '...';
            }

            // Highlight terms
            let highlighted = escapeHtml(bestSnippet);
            for (const term of terms) {
                const re = new RegExp('(' + term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
                highlighted = highlighted.replace(re, '<mark>$1</mark>');
            }

            // Score: count occurrences
            let score = 0;
            for (const t of terms) {
                const re = new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                score += (text.match(re) || []).length;
            }
            if (item.title.toLowerCase().includes(terms[0])) score += 10;

            results.push({ ...item, snippet: highlighted, score });
        }

        results.sort((a, b) => b.score - a.score);
        countDiv.textContent = results.length + ' result' + (results.length !== 1 ? 's' : '') + ' for "' + query + '"';

        if (results.length === 0) {
            resultsDiv.innerHTML = '<div class="search-empty">No results found for "' + escapeHtml(query) + '"</div>';
            return;
        }

        resultsDiv.innerHTML = results.slice(0, 20).map(r => {
            const icon = r.type === 'skill' ? '&#9889;' : '&#128218;';
            const tierLabel = r.tier === 2 ? 'Tier 2' : 'Tier 3';
            return '<div class="search-result" onclick="openSearchResult(\'' + r.type + '\', \'' + r.org + '\', \'' + r.repo + '\', \'' + r.path + '\')">' +
                '<div class="search-result-title">' + icon + ' ' + escapeHtml(r.title) + '</div>' +
                '<div class="search-result-meta">' +
                '<span class="meta-tag">' + r.type + '</span>' +
                '<span class="meta-tag">' + r.org + '</span>' +
                '<span class="meta-tag">' + tierLabel + '</span>' +
                '<span class="meta-tag">' + r.words + ' words</span>' +
                '</div>' +
                '<div class="search-result-snippet">' + r.snippet + '</div>' +
                '</div>';
        }).join('');
    }

    function openSearchResult(type, org, repo, path) {
        if (type === 'skill') {
            switchDemoTab('skills');
            const skill = DEMO_DATA.skills.find(s => s.org === org && s.repo === repo && s.path === path);
            if (skill) loadFile(org, repo, path, skill.tier, skill.tier === 3 ? 'project' : 'skills');
        } else {
            switchDemoTab('timeline');
            let mem = allMemories.find(m => m.org === org && m.file.path === path);
            if (!mem) {
                // Timeline not loaded yet - build from raw data
                const raw = DEMO_DATA.memories.find(m => m.org === org && m.path === path);
                if (raw) {
                    const fm = parseFrontmatter(raw.content);
                    const body = raw.content.replace(/^---[\s\S]*?---\n*/m, '');
                    const titleMatch = body.match(/^# (.+)$/m);
                    mem = { org: raw.org, file: { name: raw.name, path: raw.path }, content: raw.content,
                        date: fm.date || '', title: titleMatch ? titleMatch[1] : raw.name, words: wordCount(raw.content) };
                }
            }
            if (mem) loadMemory(mem);
        }
    }

    // ==========================================
    // AI Cost Analytics (real data only)
    // ==========================================
    function initAnalytics() {
        // Extract ONLY real data from session memory frontmatter
        const sessions = DEMO_DATA.memories.map(m => {
            const fm = parseFrontmatter(m.content);
            const words = wordCount(m.content);
            const body = m.content.replace(/^---[\s\S]*?---\n*/m, '');
            const titleMatch = body.match(/^# (.+)$/m);
            return {
                date: fm.date || m.name.match(/^(\d{4}-\d{2}-\d{2})/)?.[1] || '',
                title: (titleMatch ? titleMatch[1] : m.name).replace('Session: ', ''),
                org: fm.org || m.org,
                repo: fm.repo || '',
                model: fm.model || '',
                words,
                // Only use cost/tokens if explicitly in frontmatter
                cost: fm.cost_usd ? parseFloat(fm.cost_usd) : null,
                inputTokens: fm.input_tokens ? parseInt(fm.input_tokens) : null,
                outputTokens: fm.output_tokens ? parseInt(fm.output_tokens) : null,
            };
        });

        // Aggregate by date
        const byDate = {};
        for (const s of sessions) {
            if (!s.date) continue;
            if (!byDate[s.date]) byDate[s.date] = { sessions: 0, words: 0 };
            byDate[s.date].sessions++;
            byDate[s.date].words += s.words;
        }
        const dates = Object.keys(byDate).sort();
        const maxSessions = Math.max(...dates.map(d => byDate[d].sessions));

        // Aggregate by model
        const byModel = {};
        for (const s of sessions) {
            const model = s.model || 'unknown';
            if (!byModel[model]) byModel[model] = 0;
            byModel[model]++;
        }

        // Aggregate by org
        const byOrg = {};
        for (const s of sessions) {
            if (!byOrg[s.org]) byOrg[s.org] = 0;
            byOrg[s.org]++;
        }

        const hasCostData = sessions.some(s => s.cost !== null);
        const totalWords = sessions.reduce((a, b) => a + b.words, 0);
        const modelColors = { 'claude-opus-4-6': '#a78bfa', 'claude-sonnet-4-5': '#60a5fa', 'claude-haiku-4-5': '#4ade80' };
        const modelLabels = { 'claude-opus-4-6': 'Claude Opus 4.6', 'claude-sonnet-4-5': 'Claude Sonnet 4.5', 'claude-haiku-4-5': 'Claude Haiku 4.5' };

        const container = document.getElementById('analytics-content');
        document.getElementById('analytics-loading').style.display = 'none';

        // Summary cards (only real metrics)
        let html = '<div class="analytics-summary">';
        html += '<div class="analytics-card"><div class="value">' + sessions.length + '</div><div class="label">Agent Sessions</div></div>';
        html += '<div class="analytics-card"><div class="value">' + dates.length + '</div><div class="label">Active Days</div></div>';
        html += '<div class="analytics-card"><div class="value">' + Object.keys(byOrg).length + '</div><div class="label">Organizations</div></div>';
        html += '<div class="analytics-card"><div class="value">' + (totalWords / 1000).toFixed(1) + 'K</div><div class="label">Words Logged</div></div>';
        html += '</div>';

        // Sessions per day chart
        html += '<div class="chart-section"><div class="chart-title">Sessions per Day</div><div class="bar-chart">';
        for (const date of dates) {
            const d = byDate[date];
            const pct = maxSessions > 0 ? (d.sessions / maxSessions * 100) : 0;
            html += '<div class="bar-group">' +
                '<div class="bar" style="height: ' + Math.max(pct, 8) + '%"><div class="bar-value">' + d.sessions + '</div></div>' +
                '<div class="bar-label">' + date.slice(5) + '<br>' + (d.words / 1000).toFixed(1) + 'K words</div></div>';
        }
        html += '</div></div>';

        // Model distribution (from frontmatter - real data)
        html += '<div class="chart-section"><div class="chart-title">Model Usage</div><div class="model-bars">';
        for (const [model, count] of Object.entries(byModel).sort((a, b) => b[1] - a[1])) {
            const pct = (count / sessions.length * 100);
            const color = modelColors[model] || '#a78bfa';
            const label = modelLabels[model] || model;
            html += '<div class="model-row">' +
                '<div class="model-name">' + label + '</div>' +
                '<div class="model-track"><div class="model-fill" style="width:' + pct + '%;background:' + color + ';">' + Math.round(pct) + '%</div></div>' +
                '<div class="model-cost">' + count + ' sess.</div></div>';
        }
        html += '</div></div>';

        // Per-session table (only real fields)
        html += '<div class="chart-section"><div class="chart-title">Session Log</div>';
        html += '<table class="session-table"><thead><tr><th>Session</th><th>Date</th><th>Org</th><th>Model</th><th>Words</th>';
        if (hasCostData) html += '<th>Cost</th>';
        html += '</tr></thead><tbody>';
        for (const s of sessions.sort((a, b) => b.date.localeCompare(a.date))) {
            const modelShort = (modelLabels[s.model] || s.model || '-').replace('Claude ', '');
            html += '<tr><td>' + s.title.slice(0, 35) + '</td><td>' + s.date.slice(5) + '</td><td>' + s.org + '</td><td>' + modelShort + '</td><td>' + s.words.toLocaleString() + '</td>';
            if (hasCostData) html += '<td>' + (s.cost !== null ? '$' + s.cost.toFixed(2) : '-') + '</td>';
            html += '</tr>';
        }
        html += '</tbody></table></div>';

        // Cost tracking CTA
        if (!hasCostData) {
            html += '<div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem; text-align: center;">';
            html += '<div style="font-size: 1.5rem; margin-bottom: 0.5rem;">&#128176;</div>';
            html += '<div style="font-weight: 600; margin-bottom: 0.5rem;">Cost Tracking</div>';
            html += '<p style="color: var(--text-muted); font-size: 0.9rem; max-width: 500px; margin: 0 auto 1rem;">Per-session cost and token data will appear here when sessions include <code style="background: var(--code-bg); padding: 0.1rem 0.4rem; border-radius: 4px; color: var(--accent); font-size: 0.85rem;">cost_usd</code>, <code style="background: var(--code-bg); padding: 0.1rem 0.4rem; border-radius: 4px; color: var(--accent); font-size: 0.85rem;">input_tokens</code>, and <code style="background: var(--code-bg); padding: 0.1rem 0.4rem; border-radius: 4px; color: var(--accent); font-size: 0.85rem;">output_tokens</code> in memory frontmatter, or when tracked via the <a href="https://github.com/engram-hq/engram-sdk" style="color: var(--primary-light);">Engram SDK</a>.</p>';
            html += '<p style="color: var(--text-muted); font-size: 0.8rem;">All data above is real - sourced from session memory files in public GitHub repos.</p>';
            html += '</div>';
        }

        container.innerHTML = html;
    }

    // ==========================================
    // GitHub Sync Visualization
    // ==========================================
    function initSync() {
        document.getElementById('sync-loading').style.display = 'none';

        // Build sync data from demo data
        const orgs = {};
        const allFiles = [];

        for (const s of DEMO_DATA.skills) {
            if (!orgs[s.org]) orgs[s.org] = { skills: 0, memories: 0, repos: new Set() };
            orgs[s.org].skills++;
            orgs[s.org].repos.add(s.repo);
            allFiles.push({ org: s.org, repo: s.repo, path: s.path, type: 'skill', size: s.content.length, hash: simpleHash(s.content) });
        }
        for (const m of DEMO_DATA.memories) {
            if (!orgs[m.org]) orgs[m.org] = { skills: 0, memories: 0, repos: new Set() };
            orgs[m.org].memories++;
            orgs[m.org].repos.add(m.repo);
            allFiles.push({ org: m.org, repo: m.repo, path: m.path, type: 'memory', size: m.content.length, hash: simpleHash(m.content) });
        }

        const totalSkills = DEMO_DATA.skills.length;
        const totalMemories = DEMO_DATA.memories.length;
        const totalBytes = allFiles.reduce((a, f) => a + f.size, 0);
        const totalRepos = new Set(allFiles.map(f => f.org + '/' + f.repo)).size;
        const genAt = DEMO_DATA.generated_at || new Date().toISOString();

        let html = '<div class="sync-visual">';

        // Left panel: Discovered orgs
        html += '<div class="sync-panel"><h4>Discovered Organizations</h4>';
        html += '<div class="sync-progress"><div class="sync-progress-fill"></div></div>';
        for (const [org, data] of Object.entries(orgs)) {
            html += '<div class="sync-org-item"><span class="dot"></span><strong>' + org + '</strong>' +
                '<span class="count">' + data.repos.size + ' repos &middot; ' + data.skills + ' skills &middot; ' + data.memories + ' memories</span></div>';
        }
        html += '<div style="margin-top:1.5rem;">';
        html += '<div class="sync-stat-row"><span class="label">Total Organizations</span><span class="value">' + Object.keys(orgs).length + '</span></div>';
        html += '<div class="sync-stat-row"><span class="label">Total Repositories</span><span class="value">' + totalRepos + '</span></div>';
        html += '<div class="sync-stat-row"><span class="label">Skills Indexed</span><span class="value">' + totalSkills + '</span></div>';
        html += '<div class="sync-stat-row"><span class="label">Memories Indexed</span><span class="value">' + totalMemories + '</span></div>';
        html += '<div class="sync-stat-row"><span class="label">Total Size</span><span class="value">' + (totalBytes / 1024).toFixed(1) + ' KB</span></div>';
        html += '<div class="sync-stat-row"><span class="label">Last Sync</span><span class="value">' + genAt.replace('T', ' ').replace('Z', ' UTC') + '</span></div>';
        html += '</div></div>';

        // Right panel: Indexed files
        html += '<div class="sync-panel"><h4>Indexed Files (Content Hash Diff)</h4>';
        html += '<div class="sync-file-list">';
        for (const f of allFiles) {
            const icon = f.type === 'skill' ? '&#9889;' : '&#128218;';
            html += '<div class="sync-file-item">' +
                '<span class="icon">' + icon + '</span>' +
                '<span>' + f.org + '/' + f.repo + '/' + f.path.split('/').pop() + '</span>' +
                '<span class="hash">' + f.hash + '</span></div>';
        }
        html += '</div></div>';

        html += '</div>';

        document.getElementById('sync-content').innerHTML = html;
    }

    function simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = ((hash << 5) - hash + str.charCodeAt(i)) | 0;
        }
        return 'sha256:' + Math.abs(hash).toString(16).padStart(8, '0').slice(0, 8);
    }

    // ==========================================
    // Share Feature
    // ==========================================
    function shareContent(title, text, url) {
        const shareData = {
            title: 'Engram: ' + title,
            text: text + '\n\nViewed on Engram - Visual Browser for AI Agent Skills & Memories',
            url: url,
        };

        if (navigator.share) {
            navigator.share(shareData).catch(() => {});
        } else {
            // Fallback: copy formatted text to clipboard
            const copyText = shareData.title + '\n' + shareData.text + '\n' + url;
            navigator.clipboard.writeText(copyText).then(() => {
                showToast('Link copied! Paste in Slack, WhatsApp, or email.');
            }).catch(() => {
                // Final fallback
                const ta = document.createElement('textarea');
                ta.value = copyText;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('Link copied!');
            });
        }
    }

    function showToast(msg) {
        let toast = document.getElementById('share-toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'share-toast';
            toast.className = 'share-toast';
            document.body.appendChild(toast);
        }
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // ==========================================
    // Showcase Repos - Pre-baked AI-analyzed data
    // ==========================================
    const analyzedRepos = new Set();
    const SHOWCASE_COLORS = {
        'facebook/react': '#61dafb',
        'denoland/deno': '#34d399',
        'astral-sh/ruff': '#fb923c',
        'pallets/flask': '#f472b6',
        'sreniatnoc/rusd': '#f59e0b',
        'engram-hq/engram-web': '#a78bfa',
        'engram-hq/engram-sdk': '#818cf8',
        'fastapi/fastapi': '#009485',
    };

    function setExploreStatus(msg, isError) {
        const el = document.getElementById('explore-status');
        if (!el) return;
        el.textContent = msg;
        el.className = 'explore-status' + (isError ? ' error' : '');
    }

    function integrateShowcaseData(slug, generated) {
        // Register org color
        if (!ORG_COLORS[slug]) {
            ORG_COLORS[slug] = SHOWCASE_COLORS[slug] || '#a78bfa';
        }

        // Append to DEMO_DATA
        DEMO_DATA.skills.push(...generated.skills);
        DEMO_DATA.memories.push(...generated.memories);

        // Re-render Skills tree
        const tree = buildTree();
        document.getElementById('tree-loading').style.display = 'none';
        renderTree(tree);

        // Reset cached data so it rebuilds with new data
        allMemories = [];

        // Invalidate tabs for lazy re-render
        tabLoaded.timeline = false;
        tabLoaded.search = false;
        tabLoaded.analytics = false;
        tabLoaded.sync = false;

        // If currently on timeline, rebuild immediately
        const timelinePanel = document.getElementById('panel-timeline');
        if (timelinePanel && timelinePanel.classList.contains('active')) {
            tabLoaded.timeline = true;
            initTimelineGraph();
        }

        analyzedRepos.add(slug);

        // Highlight the clicked chip
        const chips = document.querySelectorAll('.showcase-chip');
        chips.forEach(c => {
            if (c.textContent.trim() === slug) c.classList.add('active');
        });
    }

    function loadShowcase(slug) {
        if (analyzedRepos.has(slug)) {
            setExploreStatus(slug + ' is already loaded');
            return;
        }

        if (!window.SHOWCASE_DATA || !window.SHOWCASE_DATA[slug]) {
            setExploreStatus('No pre-analyzed data available for ' + slug, true);
            return;
        }

        const sc = window.SHOWCASE_DATA[slug];
        if (!sc.skills || sc.skills.length === 0) {
            setExploreStatus('No skills data for ' + slug, true);
            return;
        }

        setExploreStatus('Loading AI-analyzed knowledge for ' + slug + '...');
        const generated = { skills: sc.skills, memories: sc.memories || [] };
        integrateShowcaseData(slug, generated);
        setExploreStatus('Loaded ' + generated.skills.length + ' skills + ' + generated.memories.length + ' memories for ' + slug);
    }

    // ==========================================
    // Bootstrap
    // ==========================================
    (async function() {
        try {
            await loadDemoData();

            // Skills tab
            const tree = buildTree();
            document.getElementById('tree-loading').style.display = 'none';
            renderTree(tree);

            if (tree.length > 0 && tree[0].files.length > 0) {
                const first = tree[0];
                loadFile(first.org, first.repo, first.files[0].path, first.tier, first.repoType);
                setTimeout(() => {
                    const firstFile = document.querySelector('.tree-file:not([style*="font-weight"])');
                    if (firstFile) firstFile.classList.add('active');
                }, 100);
            }

} catch (err) {
            document.getElementById('tree-loading').innerHTML =
                '<div class="demo-error">Failed to load demo: ' + err.message + '</div>';
        }
    })();
    </script>
</body>
</html>
